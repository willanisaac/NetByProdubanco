<div class="dashboard-container">
  <!-- Barra lateral -->
  <aside class="sidebar slide-in">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Panel de Control</h2>
      <p class="sidebar-subtitle">Bienvenido, {{ currentUser?.username }}</p>
    </div>
    
    <nav class="sidebar-menu">
      <ul>
        <li class="sidebar-item">
          <button 
            class="sidebar-button" 
            [class.active]="activePanel === 'products'"
            (click)="showPanel('products')"
          >
            <i>üì¶</i>
            Gesti√≥n de Productos
          </button>
        </li>
        <li class="sidebar-item">
          <button 
            class="sidebar-button" 
            [class.active]="activePanel === 'transactions'"
            (click)="showPanel('transactions')"
          >
            <i>üìã</i>
            Gesti√≥n de Transacciones
          </button>
        </li>
        <li class="sidebar-item">
          <button 
            class="sidebar-button logout-btn"
            (click)="logout()"
          >
            <i>üö™</i>
            Cerrar Sesi√≥n
          </button>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Contenido principal -->
  <main class="main-content col-12">
    <header class="content-header">
      <h1 class="content-title">{{ getPanelTitle() }}</h1>
      <p class="content-subtitle">{{ getPanelSubtitle() }}</p>
    </header>
    
    <div class="content-body">
      <!-- Panel de Gesti√≥n de Productos -->
      <div *ngIf="activePanel === 'products'" class="panel fade-in">
        <div class="panel-header">
          <h2 class="panel-title">üì¶ Gesti√≥n de Productos</h2>
          <button class="btn btn-primary" (click)="openProductModal()">
            <i>‚ûï</i> Nuevo Producto
          </button>
        </div>
        
        <div class="panel-content">
          <!-- Filtros y b√∫squeda -->
          <div class="filters-section">
            <div class="search-box">
              <input 
                type="text" 
                placeholder="Buscar productos..." 
                [(ngModel)]="productSearchTerm"
                (input)="filterProducts()"
                class="search-input"
              >
              <i class="search-icon">üîç</i>
            </div>
            <div class="filter-controls">
              <select [(ngModel)]="selectedCategory" (change)="filterProducts()" class="filter-select">
                <option value="">Todas las categor√≠as</option>
                <option *ngFor="let category of categories" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
              <select [(ngModel)]="selectedStatus" (change)="filterProducts()" class="filter-select">
                <option value="">Todos los estados</option>
                <option value="active">Activos</option>
                <option value="inactive">Inactivos</option>
              </select>
            </div>
          </div>

          <!-- Estado de carga -->
          <div *ngIf="isLoadingProducts" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Cargando productos...</p>
          </div>

          <!-- Mensaje de error -->
          <div *ngIf="productError && !isLoadingProducts" class="error-container">
            <div class="error-message">
              <h3>‚ö†Ô∏è Error al cargar productos</h3>
              <p>{{ productError }}</p>
              <button class="btn btn-primary" (click)="loadProducts()">
                üîÑ Reintentar
              </button>
            </div>
          </div>

          <!-- Tabla de productos -->
          <div *ngIf="!isLoadingProducts && !productError" class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>Categor√≠a</th>
                  <th>Precio</th>
                  <th>Stock</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of filteredProducts">
                  <td>{{ product.id.substring(0, 8) }}...</td>
                  <td>{{ product.name }}</td>
                  <td>{{ product.category }}</td>
                  <td>${{ product.price | number:'1.2-2' }}</td>
                  <td>
                    <span [class]="product.stock < 10 ? 'low-stock' : 'normal-stock'">
                      {{ product.stock }}
                    </span>
                  </td>
                  <td>
                    <span class="status-badge active">
                      Activo
                    </span>
                  </td>
                  <td class="actions">
                    <button class="btn-icon edit" (click)="editProduct(product)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-icon delete" (click)="deleteProduct(product)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <!-- Mensaje cuando no hay productos -->
            <div *ngIf="filteredProducts.length === 0" class="no-data-message">
              <p>No se encontraron productos que coincidan con los filtros aplicados.</p>
            </div>
          </div>

          <!-- Estad√≠sticas de productos -->
          <div class="stats-summary">
            <div class="stat-item">
              <span class="stat-label">Total Productos:</span>
              <span class="stat-value">{{ products.length }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Productos Activos:</span>
              <span class="stat-value">{{ getActiveProductsCount() }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Stock Bajo:</span>
              <span class="stat-value">{{ getLowStockCount() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Panel de Gesti√≥n de Transacciones -->
      <div *ngIf="activePanel === 'transactions'" class="panel fade-in">
        <div class="panel-header">
          <h2 class="panel-title">üìã Gesti√≥n de Transacciones</h2>
          <button class="btn btn-primary" (click)="openTransactionModal()">
            <i>‚ûï</i> Nueva Transacci√≥n
          </button>
        </div>
        
        <div class="panel-content">
          <!-- Filtros y b√∫squeda -->
          <div class="filters-section">
            <div class="search-box">
              <input 
                type="text" 
                placeholder="Buscar transacciones..." 
                [(ngModel)]="transactionSearchTerm"
                (input)="filterTransactions()"
                class="search-input"
              >
              <i class="search-icon">üîç</i>
            </div>
            <div class="filter-controls">
              <select [(ngModel)]="selectedTransactionType" (change)="filterTransactions()" class="filter-select">
                <option value="">Todos los tipos</option>
                <option value="entry">Entrada</option>
                <option value="exit">Salida</option>
                <option value="adjustment">Ajuste</option>
                <option value="transfer">Transferencia</option>
              </select>
              <input 
                type="date" 
                [(ngModel)]="selectedDate" 
                (change)="filterTransactions()"
                class="filter-select"
              >
            </div>
          </div>

          <!-- Estado de carga -->
          <div *ngIf="isLoadingTransactions" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Cargando transacciones...</p>
          </div>

          <!-- Mensaje de error -->
          <div *ngIf="transactionError && !isLoadingTransactions" class="error-container">
            <div class="error-message">
              <h3>‚ö†Ô∏è Error al cargar transacciones</h3>
              <p>{{ transactionError }}</p>
              <button class="btn btn-primary" (click)="loadTransactions()">
                üîÑ Reintentar
              </button>
            </div>
          </div>

          <!-- Tabla de transacciones -->
          <div *ngIf="!isLoadingTransactions && !transactionError" class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Producto</th>
                  <th>Tipo</th>
                  <th>Cantidad</th>
                  <th>Precio Unit.</th>
                  <th>Total</th>
                  <th>Fecha</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let transaction of filteredTransactions">
                  <td>{{ transaction.id.substring(0, 8) }}...</td>
                  <td>{{ getProductName(transaction.productId) }}</td>
                  <td>
                    <span [class]="'transaction-type ' + getTransactionTypeClass(transaction.type)">
                      {{ getTransactionTypeLabel(transaction.type) }}
                    </span>
                  </td>
                  <td>{{ transaction.quantity }}</td>
                  <td>{{ formatCurrency(transaction.unitPrice) }}</td>
                  <td class="total-price">{{ formatCurrency(transaction.totalPrice) }}</td>
                  <td>{{ transaction.date | date:'dd/MM/yyyy HH:mm' }}</td>
                  <td class="actions">
                    <button class="btn-icon view" (click)="openTransactionDetail(transaction)" title="Ver detalles">
                      üëÅÔ∏è
                    </button>
                    <button class="btn-icon edit" (click)="editTransaction(transaction)" title="Editar">
                      ‚úèÔ∏è
                    </button>
                    <button class="btn-icon delete" (click)="deleteTransaction(transaction)" title="Eliminar">
                      üóëÔ∏è
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <!-- Mensaje cuando no hay transacciones -->
            <div *ngIf="filteredTransactions.length === 0" class="no-data-message">
              <p>No se encontraron transacciones que coincidan con los filtros aplicados.</p>
            </div>
          </div>

          <!-- Estad√≠sticas de transacciones -->
          <div class="stats-summary">
            <div class="stat-item">
              <span class="stat-label">Total Transacciones:</span>
              <span class="stat-value">{{ transactions.length }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Entradas Hoy:</span>
              <span class="stat-value">{{ getTodayEntries() }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Salidas Hoy:</span>
              <span class="stat-value">{{ getTodayExits() }}</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Valor Total:</span>
              <span class="stat-value">{{ formatCurrency(getTotalValue()) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal de Producto -->
<app-product-modal
  *ngIf="isProductModalOpen"
  [isOpen]="isProductModalOpen"
  [product]="selectedProduct"
  [categories]="categories"
  [isLoading]="isModalLoading"
  (close)="closeProductModal()"
  (save)="saveProduct($event)"
></app-product-modal>

<!-- Modal de Transacci√≥n -->
<app-transaction-modal
  *ngIf="isTransactionModalOpen"
  [isOpen]="isTransactionModalOpen"
  [transaction]="selectedTransaction"
  [products]="products"
  [isLoading]="isTransactionModalLoading"
  (close)="closeTransactionModal()"
  (save)="saveTransaction($event)"
></app-transaction-modal>

<!-- Modal de Detalle de Transacci√≥n -->
<app-transaction-detail
  *ngIf="isTransactionDetailOpen"
  [isOpen]="isTransactionDetailOpen"
  [transaction]="selectedTransaction"
  [products]="products"
  (close)="closeTransactionDetail()"
  (edit)="onEditTransaction($event)"
  (delete)="onDeleteTransaction($event)"
></app-transaction-detail>

<!-- Notificaciones -->
<app-notification [notifications]="notifications"></app-notification>
